
<h2 class="w3-center">Abstimmungen</h2>

<div class="myQuestions w3-card-4 w3-dark-grey w3-padding-16 w3-animate-zoom" *ngIf="!resultsVisible">
    <div class="w3-container">
		<span class="w3-tooltip">
			<span style="position:absolute;left:0;top:1.8em;width:15em;" class="w3-text w3-tag">Speichere deine Eingaben lokal in deinem Browser</span> 
			<button class="w3-button w3-hover-green" (click)="toggleSave()" [class.w3-pale-green]="!doSave" [class.w3-green]="doSave">speichern</button>
		</span>
        <div class="question-tags">
        	<span class="question-tag" *ngFor="let t of question.topic"><a href="https://wahlbilanz.de/categories/#{{t}}">{{t}}</a></span>
        </div>
	    <div style="clear:both"></div>
        <header class="w3-container w3-light-grey">
            <h3>{{question.titel}}</h3>
        </header>
        <div class="question-description"> 
            {{question.beschreibung}}    
        </div>
        <div class="q-actual" id="question-{{q}}" *ngFor="let q of actualQuestions">
        	<div class="q-text">
	        	<span class="q-context">{{question.fragen[q].context}}</span>
	        	<span class="q-question">{{question.fragen[q].frage}}</span>
	        	<div class="q-supplemental">{{question.fragen[q].subtext}} <a href="{{question.fragen[q].link}}">Mehr Informationen</a></div>
        	</div>
        	<div class="q-buttons">
		        <button class="w3-button w3-hover-green w3-ripple active w3-large" [class.w3-pale-green]="answers[q]!=1" [class.w3-green]="answers[q]==1" (click)="choose(q,1)">Zustimmen</button>
		        <button class="w3-button w3-hover-red w3-ripple w3-large" [class.w3-pale-red]="answers[q]!=2" [class.w3-red]="answers[q]==2" (click)="choose(q,2)">Ablehnen</button>
		        <button class="w3-button w3-hover-blue w3-ripple w3-large" [class.w3-pale-blue]="answers[q]!=0" [class.w3-blue]="answers[q]==0" (click)="choose(q,0)">Enthalten</button>
	        </div>
	        <div style="clear:both"></div>
        </div>
	    <button class="w3-button w3-grey w3-hover-light-gray w3-left w3-ripple w3-large" (click)="nextQuestion(-1)" *ngIf="questionIndex > 0">vorherige Frage</button>
	    <button class="w3-button w3-grey w3-hover-light-gray w3-right w3-ripple w3-large" (click)="nextQuestion(1)" *ngIf="questionIndex < questionData.length - 1">nächste Frage</button>
	    <button class="w3-button w3-grey w3-hover-light-gray w3-right w3-ripple w3-large" (click)="nextQuestion(100)" *ngIf="questionIndex >= questionData.length - 10">Auswertung</button>
     </div>
</div>

<div class="w3-light-grey">
  <div class="w3-container w3-green w3-center" [style.width.%]="progress">{{progress | number:'1.1-1'}}%</div>
</div>

<div class="myResult w3-card-4 w3-light-grey w3-padding-16 w3-animate-bottom" *ngIf="resultsVisible">
    <div class="w3-container">
        <header class="w3-container w3-green">
            <h3>Auswertung </h3>
        </header>
        <h4>Welche Partei hat am ähnlichsten wie du abgestimmt?</h4>
        In der folgenden Tabelle siehst du wieviele Abgeordnete in den verschiedenen Parteien in deinem Sinne abgestimmt haben:
        <div class="w3-responsive">
	        <table id="auswertungstabelle" class="w3-table w3-bordered w3-hoverable">
	        	<thead class="w3-dark-grey">
	        		<tr>
	        			<th class="w3-left-align">Abstimmung</th>
	        			<th class="w3-center">Deine Antwort</th>
	        			<th class="w3-right-align">Icon Gruene</th>
	        			<th class="w3-right-align">Icon CDU</th>
	        			<th class="w3-right-align">Icon DIE LINKE</th>
	        			<th class="w3-right-align">Icon SPD</th>
	        	</thead>
	        	<tbody>
	        		<ng-container *ngFor="let quest of questionData; let i = index">
		        		<tr class="auswertung-abschnitt">
		        			<th colspan="6" class="w3-grey w3-left-align" (click)="showQuestion(i)">{{quest.titel}}</th>
		        		</tr>
		        		<ng-container *ngFor="let q of quest.fragenIds">
			        		<tr class="auswertung-zeile" id="auswertung-{{q}}">
			        			<td class="w3-left-align">{{quest.fragen[q].short}}</td>
			        			<td class="w3-center" [class.w3-green]="answers[q]==1" [class.w3-red]="answers[q]==2" [class.w3-blue]="answers[q]==0">{{partyVotes[answers[q]]}}</td>
			        			<td class="w3-right-align w3-tooltip">{{quest.fragen[q]['gruenen'] | percent:'1.1-1'}}<span style="position:absolute;z-index:1;right:-30%;top:2.3em" class="w3-text w3-tag"><app-party-votes class="w3-tag" [results]="quest.fragen[q].results['gruenen']"></app-party-votes></span></td>
			        			<td class="w3-right-align w3-tooltip">{{quest.fragen[q]['cdu/csu'] | percent:'1.1-1'}}<span style="position:absolute;z-index:1;right:-30%;top:2.4em" class="w3-text"><app-party-votes class="w3-tag" [results]="quest.fragen[q].results['cdu/csu']"></app-party-votes></span></td>
			        			<td class="w3-right-align w3-tooltip">{{quest.fragen[q]['die.linke'] | percent:'1.1-1'}}<span style="position:absolute;z-index:1;right:-25%;top:2.5em" class="w3-text"><app-party-votes class="w3-tag" [results]="quest.fragen[q].results['die.linke']"></app-party-votes></span></td>
			        			<td class="w3-right-align w3-dropdown-hover">{{quest.fragen[q]['spd'] | percent:'1.1-1'}}<span style="position:absolute;z-index:100;right:0;top:2.6em" class="w3-dropdown-content"><app-party-votes class="w3-tag" [results]="quest.fragen[q].results.spd"></app-party-votes></span></td>
			        		</tr>
		        		</ng-container>
	        		</ng-container>
					<tr class="auswertung-abschnitt">
						<th colspan="6" class="w3-grey w3-left-align">Gesamt</th>
					</tr>
					<tr class="auswertung-zeile">
						<td class="w3-left-align">Gesamtergebnis:</td>
			        	<td class="w3-center"></td>
			        	<td class="w3-right-align">{{overallResult['gruenen'] | percent:'1.1-1'}}</td>
						<td class="w3-right-align">{{overallResult['cdu/csu'] | percent:'1.1-1'}}</td>
						<td class="w3-right-align">{{overallResult['die.linke'] | percent:'1.1-1'}}</td>
						<td class="w3-right-align">{{overallResult['spd'] | percent:'1.1-1'}}</td>
					</tr>
	        	</tbody>
	        </table>
        </div> 
    </div>
</div>
